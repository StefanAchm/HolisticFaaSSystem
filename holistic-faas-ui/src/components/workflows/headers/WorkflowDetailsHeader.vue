<template>
  <div>

    <!-- Header -->
    <v-toolbar flat fluid>
      <v-toolbar-title>Workflow: {{ workflow.name }}</v-toolbar-title>
      <v-spacer></v-spacer>
      <v-btn color="primary" class="mx-2" @click="openFunctionImplementationDialog">Add Implementation</v-btn>
      <v-btn color="primary" class="mx-2" @click="openDeploymentDialog">Add Deployment</v-btn>
    </v-toolbar>

    <!-- Dialogs -->
    <FunctionImplementationDialogExtended
        :dialog.sync="functionImplementationDialogVisible"
        :workflow="workflow"
        @dialog-closed="dialogClosed()"
    />

    <WorkflowDeploymentDialog
        :dialog.sync="deploymentDialogVisible"
        :workflow-deployment="workflowDeployment"
        @dialog-closed="dialogClosed()"
    />
  </div>
</template>

<script>

import HfApi from "@/utils/hf-api";
import FunctionImplementationDialogExtended
  from "@/components/function/dialogs/FunctionImplementationDialogExtended.vue";
import WorkflowDeploymentDialog from "@/components/workflows/WorkflowDeploymentDialog.vue";

export default {

  props: {
    workflow: {
      type: Object,
      required: true
    },
  },

  components: {
    WorkflowDeploymentDialog,
    FunctionImplementationDialogExtended},

  data() {
    return {
      workflowDeployment: {}, // This will hold the fetched workflow deployment
      functionImplementationDialogVisible: false,
      deploymentDialogVisible: false,
    };
  },

  created() {
    this.getWorkflowDeployment();
  },

  computed: {

  },

  methods: {

    dialogClosed() {
      this.$emit('workflow-updated');
    },

    openFunctionImplementationDialog() {
      this.functionImplementationDialogVisible = true;
    },

    openDeploymentDialog() {
      this.deploymentDialogVisible = true;
    },

    getWorkflowDeployment() {

      HfApi.prepareWorkflowDeployment(this.$route.params.id)
          .then((response) => {

        this.workflowDeployment = response.data

      })

    },

  },

}

</script>